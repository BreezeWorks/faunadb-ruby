<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Fauna::Page - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/darkfish.js"></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    <div id="sections-section" class="nav-section">
  <h3>Sections</h3>

  <ul class="link-list" role="directory">
    
      <li><a href="#5Buntitled-5D"></a></li>
    
      <li><a href="#Builders">Builders</a></li>
    
      <li><a href="#Data">Data</a></li>
    
      <li><a href="#Pagination">Pagination</a></li>
    
  </ul>
</div>

    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">Object
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-i-3D-3D">#==</a>
    
    <li ><a href="#method-i-after">#after</a>
    
    <li ><a href="#method-i-all">#all</a>
    
    <li ><a href="#method-i-before">#before</a>
    
    <li ><a href="#method-i-data">#data</a>
    
    <li ><a href="#method-i-each">#each</a>
    
    <li ><a href="#method-i-eql-3F">#eql?</a>
    
    <li ><a href="#method-i-filter">#filter</a>
    
    <li ><a href="#method-i-foreach-21">#foreach!</a>
    
    <li ><a href="#method-i-load-21">#load!</a>
    
    <li ><a href="#method-i-map">#map</a>
    
    <li ><a href="#method-i-page_after">#page_after</a>
    
    <li ><a href="#method-i-page_before">#page_before</a>
    
    <li ><a href="#method-i-postprocessing_map">#postprocessing_map</a>
    
    <li ><a href="#method-i-reverse_each">#reverse_each</a>
    
    <li ><a href="#method-i-with_params">#with_params</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Fauna::Page">
  <h1 id="class-Fauna::Page" class="class">
    class Fauna::Page
  </h1>

  <section class="description">
    
<p>Helper for handling pagination over sets.</p>

<p>Given a client and a set, allows you to iterate as well as individually
move page by page over a set.</p>

<p>Pages lazily load the contents of the page. Loading will occur when
<code>data</code>, <code>before</code>, or <code>after</code> are first
accessed for a new page. Additionally this will occur when calling
<code>page_before</code> or <code>page_after</code> without calling one of
the data methods first (as the first page must be checked to find the next
page). Pages created by builders will unload any data from the current
page. Pages will always proceed in the requested direction.</p>

<p>Explicit paging is done via the <code>page_after</code> and
<code>page_before</code> methods. Iteration can be done via the
<code>each</code> and <code>reverse_each</code> enumerators. A single page
can be retrieved by passing a cursor and then accessing it&#39;s data.</p>

<p>Examples:</p>

<p>Paging over a class index</p>

<pre class="ruby"><span class="ruby-identifier">page</span> = <span class="ruby-constant">Page</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">client</span>, <span class="ruby-constant">Query</span>.<span class="ruby-identifier">match</span>(<span class="ruby-constant">Ref</span>(<span class="ruby-string">&#39;indexes/items&#39;</span>)))
</pre>

<p>Paging over a class index 5 at a time, mapping the refs to the
<code>data.value</code> for each instance</p>

<pre class="ruby"><span class="ruby-identifier">page</span> = <span class="ruby-constant">Page</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">client</span>, <span class="ruby-constant">Query</span>.<span class="ruby-identifier">match</span>(<span class="ruby-constant">Ref</span>(<span class="ruby-string">&#39;indexes/items&#39;</span>)), <span class="ruby-identifier">size</span><span class="ruby-operator">:</span> <span class="ruby-value">5</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ref</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">select</span> [<span class="ruby-string">&#39;data&#39;</span>, <span class="ruby-string">&#39;value&#39;</span>], <span class="ruby-identifier">get</span>(<span class="ruby-identifier">ref</span>)
<span class="ruby-keyword">end</span>

<span class="ruby-comment"># Same thing, but using builders instead</span>

<span class="ruby-identifier">page</span> = <span class="ruby-constant">Page</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">client</span>, <span class="ruby-constant">Query</span>.<span class="ruby-identifier">match</span>(<span class="ruby-constant">Ref</span>(<span class="ruby-string">&#39;indexes/items&#39;</span>))).<span class="ruby-identifier">with_params</span>(<span class="ruby-identifier">size</span><span class="ruby-operator">:</span> <span class="ruby-value">5</span>).<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ref</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">select</span> [<span class="ruby-string">&#39;data&#39;</span>, <span class="ruby-string">&#39;value&#39;</span>], <span class="ruby-identifier">get</span>(<span class="ruby-identifier">ref</span>)
<span class="ruby-keyword">end</span>
</pre>

<p>Paging over a class index, mapping refs to the <code>data.value</code> for
each instance, filtering out odd numbers, and multiplying the value:</p>

<pre class="ruby"><span class="ruby-identifier">page</span> = <span class="ruby-constant">Page</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">client</span>, <span class="ruby-constant">Query</span>.<span class="ruby-identifier">match</span>(<span class="ruby-constant">Ref</span>(<span class="ruby-string">&#39;indexes/items&#39;</span>))).<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ref</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">select</span> [<span class="ruby-string">&#39;data&#39;</span>, <span class="ruby-string">&#39;value&#39;</span>], <span class="ruby-identifier">get</span>(<span class="ruby-identifier">ref</span>)
<span class="ruby-keyword">end</span>.<span class="ruby-identifier">filter</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">equals</span> <span class="ruby-identifier">modulo</span>(<span class="ruby-identifier">value</span>, <span class="ruby-value">2</span>), <span class="ruby-value">0</span>
<span class="ruby-keyword">end</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">multiply</span> <span class="ruby-identifier">value</span>, <span class="ruby-value">2</span>
<span class="ruby-keyword">end</span>
</pre>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    
    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      
      <div id="attribute-i-params" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">params</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        <p>The configured params used for the current pagination.</p>
        
        </div>
      </div>
      
    </section>
    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(client, set, params = {}, &lambda)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Creates a pagination helper for paging/iterating over a set.</p>
<dl class="rdoc-list note-list"><dt><code>client</code>
<dd>
<p><a href="Client.html">Client</a> to execute queries with.</p>
</dd><dt><code>set</code>
<dd>
<p>A set query to paginate over.</p>
</dd><dt><code>params</code>
<dd>
<p>A list of parameters to pass to <a
href="https://fauna.com/documentation/queries#read_functions-paginate_set">paginate</a>.</p>
</dd><dt><code>lambda</code>
<dd>
<p>Optional lambda to map the generated paginate query with. The block will be
run in a query context. An element from the current page will be passed
into the block as an argument. See <a href="Page.html#method-i-map">map</a>
for more info.</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/fauna/page.rb, line 52</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">client</span>, <span class="ruby-identifier">set</span>, <span class="ruby-identifier">params</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">lambda</span>)
  <span class="ruby-ivar">@client</span> = <span class="ruby-identifier">client</span>
  <span class="ruby-ivar">@set</span> = <span class="ruby-identifier">set</span>
  <span class="ruby-ivar">@params</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">dup</span>
  <span class="ruby-ivar">@fauna_funcs</span> = []
  <span class="ruby-ivar">@postprocessing_map</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-ivar">@fauna_funcs</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">proc</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">query</span><span class="ruby-operator">|</span> <span class="ruby-identifier">map</span>(<span class="ruby-identifier">query</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">lambda</span>) } <span class="ruby-keyword">unless</span> <span class="ruby-identifier">lambda</span>.<span class="ruby-identifier">nil?</span>

  <span class="ruby-identifier">unload_page</span>
  <span class="ruby-ivar">@params</span>.<span class="ruby-identifier">freeze</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-3D-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">==</span><span
            class="method-args">(other)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns <code>true</code> if <code>other</code> is a <a
href="Page.html">Page</a> and contains the same configuration and data.</p>
          
          

          
          <div class="method-source-code" id="3D-3D-source">
            <pre><span class="ruby-comment"># File lib/fauna/page.rb, line 66</span>
<span class="ruby-keyword">def</span> <span class="ruby-operator">==</span>(<span class="ruby-identifier">other</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">other</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Page</span>
  <span class="ruby-ivar">@populated</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">other</span>.<span class="ruby-identifier">instance_variable_get</span>(<span class="ruby-value">:@populated</span>) <span class="ruby-operator">&amp;&amp;</span>
    <span class="ruby-ivar">@data</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">other</span>.<span class="ruby-identifier">instance_variable_get</span>(<span class="ruby-value">:@data</span>) <span class="ruby-operator">&amp;&amp;</span>
    <span class="ruby-ivar">@before</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">other</span>.<span class="ruby-identifier">instance_variable_get</span>(<span class="ruby-value">:@before</span>) <span class="ruby-operator">&amp;&amp;</span>
    <span class="ruby-ivar">@after</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">other</span>.<span class="ruby-identifier">instance_variable_get</span>(<span class="ruby-value">:@after</span>) <span class="ruby-operator">&amp;&amp;</span>
    <span class="ruby-ivar">@client</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">other</span>.<span class="ruby-identifier">instance_variable_get</span>(<span class="ruby-value">:@client</span>) <span class="ruby-operator">&amp;&amp;</span>
    <span class="ruby-ivar">@set</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">other</span>.<span class="ruby-identifier">instance_variable_get</span>(<span class="ruby-value">:@set</span>) <span class="ruby-operator">&amp;&amp;</span>
    <span class="ruby-ivar">@params</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">other</span>.<span class="ruby-identifier">instance_variable_get</span>(<span class="ruby-value">:@params</span>) <span class="ruby-operator">&amp;&amp;</span>
    <span class="ruby-ivar">@fauna_funcs</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">other</span>.<span class="ruby-identifier">instance_variable_get</span>(<span class="ruby-value">:@fauna_funcs</span>) <span class="ruby-operator">&amp;&amp;</span>
    <span class="ruby-ivar">@postprocessing_map</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">other</span>.<span class="ruby-identifier">instance_variable_get</span>(<span class="ruby-value">:@postprocessing_map</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="Page.html#method-i-eql-3F">eql?</a>
        </div>
        

        
      </div>

    
      <div id="method-i-eql-3F" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">eql?</span><span
            class="method-args">(other)</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="Page.html#method-i-3D-3D">==</a>
        </div>
        
      </div>

    
      <div id="method-i-load-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">load!</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Explicitly loads data for the current page if it has not already been
loaded.</p>

<p>Returns <code>true</code> if the data was just loaded and
<code>false</code> if it was already loaded.</p>
          
          

          
          <div class="method-source-code" id="load-21-source">
            <pre><span class="ruby-comment"># File lib/fauna/page.rb, line 88</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">load!</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@populated</span>
    <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">load_page</span>(<span class="ruby-identifier">get_page</span>(<span class="ruby-ivar">@params</span>))
    <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>

  
  
  <section id="Builders" class="documentation-section">
    
    <header class="documentation-section-title">
      <h2>
        Builders
      </h2>
      <span class="section-click-top">
        <a href="#top">&uarr; top</a>
      </span>
    </header>
    

    

    

    

    
     <section id="public-instance-Builders-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-filter" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">filter</span><span
            class="method-args">(&lambda)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a copy of the page with a fauna <code>filter</code> using the given
lambda chained onto the paginate query.</p>

<p>The lambda will be passed into a <code>filter</code> function that wraps
the generated paginate query. Additional collection functions may be
combined by chaining them together.</p>

<p>The lambda will be run in a <a
href="Query.html#method-c-expr">Fauna::Query.expr</a> context, and passed
an element from the current page as an argument.</p>

<p>Example of filtering out odd numbers from a set of numbers:</p>

<pre class="ruby"><span class="ruby-identifier">page</span>.<span class="ruby-identifier">filter</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span> <span class="ruby-identifier">equals</span>(<span class="ruby-identifier">modulo</span>(<span class="ruby-identifier">value</span>, <span class="ruby-value">2</span>), <span class="ruby-value">0</span>) }
</pre>
          
          

          
          <div class="method-source-code" id="filter-source">
            <pre><span class="ruby-comment"># File lib/fauna/page.rb, line 174</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">filter</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">lambda</span>)
  <span class="ruby-identifier">with_dup</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">page</span>.<span class="ruby-identifier">instance_variable_get</span>(<span class="ruby-value">:@fauna_funcs</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">proc</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">query</span><span class="ruby-operator">|</span> <span class="ruby-identifier">filter</span>(<span class="ruby-identifier">query</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">lambda</span>) }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-map" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">map</span><span
            class="method-args">(&lambda)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a copy of the page with a fauna <code>map</code> using the given
lambda chained onto the paginate query.</p>

<p>The lambda will be passed into a <code>map</code> function that wraps the
generated paginate query. Additional collection functions may be combined
by chaining them together.</p>

<p>The lambda will be run in a <a
href="Query.html#method-c-expr">Fauna::Query.expr</a> context, and passed
an element from the current page as an argument.</p>

<p>Example of mapping a set of refs to their instances:</p>

<pre class="ruby"><span class="ruby-identifier">page</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">ref</span><span class="ruby-operator">|</span> <span class="ruby-identifier">get</span> <span class="ruby-identifier">ref</span> }
</pre>
          
          

          
          <div class="method-source-code" id="map-source">
            <pre><span class="ruby-comment"># File lib/fauna/page.rb, line 157</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">lambda</span>)
  <span class="ruby-identifier">with_dup</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">page</span>.<span class="ruby-identifier">instance_variable_get</span>(<span class="ruby-value">:@fauna_funcs</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">proc</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">query</span><span class="ruby-operator">|</span> <span class="ruby-identifier">map</span>(<span class="ruby-identifier">query</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">lambda</span>) }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-postprocessing_map" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">postprocessing_map</span><span
            class="method-args">(&block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a copy of the page with the given ruby block set.</p>

<p>The block will be used to map the returned data elements from the executed
fauna query. Only one postprocessing map can be configured at a time.</p>

<p>Intended for use when the elements in a page need to be converted within
ruby (ie loading into a model). Wherever the operation can be performed
from within FaunaDB, <code>map</code> should be used instead.</p>

<p>The block will be passed the each element as a parameter from the data of
the page currently being loaded.</p>

<p>Example of loading instances into your own model:</p>

<pre class="ruby"><span class="ruby-identifier">page</span>.<span class="ruby-identifier">postprocessing_map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">instance</span><span class="ruby-operator">|</span> <span class="ruby-constant">YourModel</span>.<span class="ruby-identifier">load</span>(<span class="ruby-identifier">instance</span>) }
</pre>
          
          

          
          <div class="method-source-code" id="postprocessing_map-source">
            <pre><span class="ruby-comment"># File lib/fauna/page.rb, line 194</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">postprocessing_map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">with_dup</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">page</span>.<span class="ruby-identifier">instance_variable_set</span>(<span class="ruby-value">:@postprocessing_map</span>, <span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-with_params" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">with_params</span><span
            class="method-args">(params = {})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a copy of the page with the given <code>params</code> set.</p>

<p>See <a
href="https://fauna.com/documentation/queries#read_functions-paginate_set">paginate</a>
for more details.</p>
          
          

          
          <div class="method-source-code" id="with_params-source">
            <pre><span class="ruby-comment"># File lib/fauna/page.rb, line 132</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">with_params</span>(<span class="ruby-identifier">params</span> = {})
  <span class="ruby-identifier">with_dup</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">page_params</span> = <span class="ruby-identifier">page</span>.<span class="ruby-identifier">instance_variable_get</span>(<span class="ruby-value">:@params</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-constant">CURSOR_KEYS</span>.<span class="ruby-identifier">any?</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span> <span class="ruby-identifier">params</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">key</span> }
      <span class="ruby-comment"># Remove previous cursor</span>
      <span class="ruby-constant">CURSOR_KEYS</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span> <span class="ruby-identifier">page_params</span>.<span class="ruby-identifier">delete</span> <span class="ruby-identifier">key</span> }
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># Update params</span>
    <span class="ruby-identifier">page_params</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">params</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>

  
  
  <section id="Data" class="documentation-section">
    
    <header class="documentation-section-title">
      <h2>
        Data
      </h2>
      <span class="section-click-top">
        <a href="#top">&uarr; top</a>
      </span>
    </header>
    

    

    

    

    
     <section id="public-instance-Data-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-after" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">after</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>After cursor for the current page.</p>

<p>Lazily loads the page data if it has not already been loaded.</p>
          
          

          
          <div class="method-source-code" id="after-source">
            <pre><span class="ruby-comment"># File lib/fauna/page.rb, line 121</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">after</span>
  <span class="ruby-identifier">load!</span>
  <span class="ruby-ivar">@after</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-before" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">before</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Before cursor for the current page.</p>

<p>Lazily loads the page data if it has not already been loaded.</p>
          
          

          
          <div class="method-source-code" id="before-source">
            <pre><span class="ruby-comment"># File lib/fauna/page.rb, line 112</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">before</span>
  <span class="ruby-identifier">load!</span>
  <span class="ruby-ivar">@before</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-data" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">data</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Data contained within the current page.</p>

<p>Lazily loads the page data if it has not already been loaded.</p>
          
          

          
          <div class="method-source-code" id="data-source">
            <pre><span class="ruby-comment"># File lib/fauna/page.rb, line 103</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">data</span>
  <span class="ruby-identifier">load!</span>
  <span class="ruby-ivar">@data</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>

  
  
  <section id="Pagination" class="documentation-section">
    
    <header class="documentation-section-title">
      <h2>
        Pagination
      </h2>
      <span class="section-click-top">
        <a href="#top">&uarr; top</a>
      </span>
    </header>
    

    

    

    

    
     <section id="public-instance-Pagination-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-all" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">all</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the flattened contents of the set as an array.</p>

<p>Ideal for when you need the full contents of a set with a known small size.
If you need to iterate over a set of large or unknown size, it is
recommended to use <code>each</code> instead.</p>

<p>The set is paged in the <code>after</code> direction.</p>
          
          

          
          <div class="method-source-code" id="all-source">
            <pre><span class="ruby-comment"># File lib/fauna/page.rb, line 265</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">all</span>
  <span class="ruby-identifier">each</span>.<span class="ruby-identifier">flat_map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span> }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-each" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">each</span><span
            class="method-args">() { |data| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns an enumerator that iterates in the <code>after</code> direction.</p>

<p>When a block is provided, the return of the block will always be
<code>nil</code> (to avoid loading large sets into memory).</p>
          
          

          
          <div class="method-source-code" id="each-source">
            <pre><span class="ruby-comment"># File lib/fauna/page.rb, line 224</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">each</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">enum_for</span>(<span class="ruby-value">:each</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">block_given?</span>

  <span class="ruby-comment"># Return current page</span>
  <span class="ruby-keyword">yield</span> <span class="ruby-identifier">data</span>

  <span class="ruby-comment"># Begin returning pages after</span>
  <span class="ruby-identifier">page</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">page_after</span>
  <span class="ruby-keyword">until</span> <span class="ruby-identifier">page</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">yield</span> <span class="ruby-identifier">page</span>.<span class="ruby-identifier">data</span>
    <span class="ruby-identifier">page</span> = <span class="ruby-identifier">page</span>.<span class="ruby-identifier">page_after</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-foreach-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">foreach!</span><span
            class="method-args">(&lambda)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Iterates over the entire set, applying the configured lambda in a foreach
block, and discarding the result.</p>

<p>Ideal for performing a <code>foreach</code> over an entire set (like
deleting all instances in a set). The set is iterated in the
<code>after</code> direction. The <code>foreach</code> will be chained on
top of any previously configured collection functions.</p>

<p>Example of deleting every instance in a set:</p>

<pre class="ruby"><span class="ruby-identifier">page</span>.<span class="ruby-identifier">foreach!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">ref</span><span class="ruby-operator">|</span> <span class="ruby-identifier">delete</span> <span class="ruby-identifier">ref</span> }
</pre>
          
          

          
          <div class="method-source-code" id="foreach-21-source">
            <pre><span class="ruby-comment"># File lib/fauna/page.rb, line 278</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">foreach!</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">lambda</span>)
  <span class="ruby-comment"># Create new page with foreach block</span>
  <span class="ruby-identifier">iter_page</span> = <span class="ruby-identifier">with_dup</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">page</span>.<span class="ruby-identifier">instance_variable_get</span>(<span class="ruby-value">:@fauna_funcs</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">proc</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">query</span><span class="ruby-operator">|</span> <span class="ruby-identifier">foreach</span>(<span class="ruby-identifier">query</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">lambda</span>) }
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Apply to all pages in the set</span>
  <span class="ruby-keyword">until</span> <span class="ruby-identifier">iter_page</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">iter_page</span>.<span class="ruby-identifier">load!</span>
    <span class="ruby-identifier">iter_page</span> = <span class="ruby-identifier">iter_page</span>.<span class="ruby-identifier">page_after</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-page_after" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">page_after</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The page after the current one in the set.</p>

<p>Returns <code>nil</code> when there are no more pages after the current
page. Lazily loads the current page if it has not already been loaded in
order to determine the page after.</p>
          
          

          
          <div class="method-source-code" id="page_after-source">
            <pre><span class="ruby-comment"># File lib/fauna/page.rb, line 207</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">page_after</span>
  <span class="ruby-identifier">new_page</span>(<span class="ruby-value">:after</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-page_before" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">page_before</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The page before the current one in the set.</p>

<p>Returns <code>nil</code> when there are no more pages before the current
page. Lazily loads the current page if it has not already been loaded in
order to determine the page before.</p>
          
          

          
          <div class="method-source-code" id="page_before-source">
            <pre><span class="ruby-comment"># File lib/fauna/page.rb, line 216</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">page_before</span>
  <span class="ruby-identifier">new_page</span>(<span class="ruby-value">:before</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-reverse_each" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reverse_each</span><span
            class="method-args">() { |data| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns an enumerator that iterates in the <code>before</code> direction.</p>

<p>When a block is provided, the return of the block will always be
<code>nil</code> (to avoid loading large sets into memory).</p>

<p>While the paging will occur in the reverse direction, the data returned
will still be in the normal direction.</p>
          
          

          
          <div class="method-source-code" id="reverse_each-source">
            <pre><span class="ruby-comment"># File lib/fauna/page.rb, line 244</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reverse_each</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">enum_for</span>(<span class="ruby-value">:reverse_each</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">block_given?</span>

  <span class="ruby-comment"># Return current page</span>
  <span class="ruby-keyword">yield</span> <span class="ruby-identifier">data</span>

  <span class="ruby-comment"># Begin returning pages before</span>
  <span class="ruby-identifier">page</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">page_before</span>
  <span class="ruby-keyword">until</span> <span class="ruby-identifier">page</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">yield</span> <span class="ruby-identifier">page</span>.<span class="ruby-identifier">data</span>
    <span class="ruby-identifier">page</span> = <span class="ruby-identifier">page</span>.<span class="ruby-identifier">page_before</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

